<!DOCTYPE html>
<html>
<body>
<br/><br/><code style="background-color:rgb(255,0,0);padding-left:0px;"><code title="{
$$ = $1;
}"> type </code><code style="background-color:rgb(255,255,0);padding-left:0px;"><code title="{
$$ = $1;
}"> type </code><code title="{
insert_symbol($3, PAR, $2, 1);
set_ptyp(fun_idx, $2);
$$ = 1;
}"> parameter </code></code><br/><code style="background-color:rgb(0,255,0);padding-left:0px;"><code title="{
$$ = $1;
}"> type </code><code title="{
if(lookup_symbol($3, PAR) != -1)
	err(&quot;redefinition of '%s'&quot;, $3);
else
	insert_symbol($3, VAR, $2, ++var_num);
}"> variable </code></code> variable_list <br/><code style="background-color:rgb(0,255,255);padding-left:0px;"><code style="background-color:rgb(0,0,255);padding-left:0px;"><code title="{
if( ($$ = lookup_symbol($1, (VAR|PAR))) == -1)
	err(&quot;'%s' undeclared&quot;, $1);
}"> exp </code><code title="{
$$ = insert_literal($1, INT);
}"> literal </code> exp <code title="{
if(!check_types($2, $5))
	err(&quot;invalid operands to relational operator&quot;);
$$ = $3 + (get_type($2) - 1) * RELOP_NUMBER;
gen_cmp($2, $5);
}"> rel_exp </code></code><br/><code style="background-color:rgb(255,64,0);padding-left:0px;"><code title="{
$$ = insert_literal($1, INT);
}"> literal </code> exp <code title="{
if( ($$ = lookup_symbol($1, (VAR|PAR))) == -1)
	err(&quot;'%s' undeclared&quot;, $1);
}"> exp </code><code title="{
if(!check_types($1, $4))
	err(&quot;invalid operands: arithmetic operation&quot;);
$$ = gen_arith($2, $1, $4);
}"> num_exp </code><code title="{
int i;
if( (i = lookup_symbol($2, (VAR|PAR))) == -1 )
	err(&quot;invalid lvalue '%s' in assignment&quot;, $2);
else
	if(!check_types(i, $5))
		 err(&quot;incompatible types in assignment&quot;);
gen_mov($5, i);
}"> assignment_statement </code></code><br/><code title="{
lab_num++;
gen_snlab(&quot;if&quot;, lab_num);
}

{
code(&quot;%s\n\t\t\t%s\t@false%d&quot;, tab, get_opjump($5),lab_num);
gen_snlab(&quot;true&quot;,lab_num);
}

{
code(&quot;%s\n\t\t\tJMP \t@exit%d&quot;, tab, lab_num);
gen_snlab(&quot;false&quot;, lab_num);
}"> if_part<br/> </code><code style="background-color:rgb(191,255,0);padding-left:0px;"><code title="{
if( ($$ = lookup_symbol($1, (VAR|PAR))) == -1)
	err(&quot;'%s' undeclared&quot;, $1);
}"> exp </code><code title="{
int i;
if( (i = lookup_symbol($2, (VAR|PAR))) == -1 )
	err(&quot;invalid lvalue '%s' in assignment&quot;, $2);
else
	if(!check_types(i, $5))
		 err(&quot;incompatible types in assignment&quot;);
gen_mov($5, i);
}"> assignment_statement </code></code><br/><code title="{
gen_snlab(&quot;exit&quot;, lab_num);
}"> if_statement </code></code><br/><code style="background-color:rgb(0,255,64);padding-left:0px;"><code title="{
if( ($$ = lookup_symbol($1, (VAR|PAR))) == -1)
	err(&quot;'%s' undeclared&quot;, $1);
}"> exp </code><code title="{
if(!check_types(fun_idx, $4))
	err(&quot;incompatible types in return&quot;);
gen_mov($4, FUN_REG);
}"> return_statement </code></code><br/> statement_list  body <code title="{
fun_idx = insert_symbol($3, FUN, $2, NO_ATTR); 
code(&quot;\n%s:&quot;, $3); 
code(&quot;%s\n\t\t\tPUSH\t%%14&quot;,tab);
code(&quot;%s\n\t\t\tMOV \t%%15,%%14&quot;,tab);
}

{
set_attr(fun_idx, $6);
var_num = 0;
}

{
if (get_last_element() > fun_idx)
	clear_symbols(fun_idx + 1);

gen_sslab($3,&quot;_exit&quot;);
code(&quot;%s\n\t\t\tMOV \t%%14,%%15&quot;,tab);
code(&quot;%s\n\t\t\tPOP \t%%14&quot;,tab);
code(&quot;%s\n\t\t\tRET&quot;,tab);
}"> function </code></code><br/><br/><code style="background-color:rgb(0,191,255);padding-left:0px;"><code title="{
$$ = $1;
}"> type </code><code title="{
$$ = 0;
}"> parameter </code><br/> variable_list <br/><code style="background-color:rgb(255,128,0);padding-left:0px;"><code style="background-color:rgb(128,255,0);padding-left:0px;"><code title="{
$$ = insert_literal($1, INT);
}"> literal </code> exp <code title="{
if(get_ptyp(fcall_idx) != get_type($1))
	err(&quot;incompatible type for argument in '%s'&quot;,get_name(fcall_idx));
gen_push($1);
$$ = 1;
}"> argument </code><code title="{
if((fcall_idx = lookup_symbol($1, FUN)) == -1)
	err(&quot;'%s' is not a function&quot;, $1);
}

{
if (get_attr(fcall_idx) != $5)
	err(&quot;wrong number of arguments to function '%s'&quot;,get_name(fcall_idx));
gen_fcall(fcall_idx);
gen_clear_args($5);
set_reg_type(FUN_REG, get_type(fcall_idx));
$$ = FUN_REG;
}"> function_call </code></code><br/><code title="{
$$ = take_reg();
gen_mov(FUN_REG, $$);
}"> exp </code><code title="{
if(!check_types(fun_idx, $4))
	err(&quot;incompatible types in return&quot;);
gen_mov($4, FUN_REG);
}"> return_statement </code></code><br/> statement_list  body <code title="{
fun_idx = insert_symbol($3, FUN, $2, NO_ATTR); 
code(&quot;\n%s:&quot;, $3); 
code(&quot;%s\n\t\t\tPUSH\t%%14&quot;,tab);
code(&quot;%s\n\t\t\tMOV \t%%15,%%14&quot;,tab);
}

{
set_attr(fun_idx, $6);
var_num = 0;
}

{
if (get_last_element() > fun_idx)
	clear_symbols(fun_idx + 1);

gen_sslab($3,&quot;_exit&quot;);
code(&quot;%s\n\t\t\tMOV \t%%14,%%15&quot;,tab);
code(&quot;%s\n\t\t\tPOP \t%%14&quot;,tab);
code(&quot;%s\n\t\t\tRET&quot;,tab);
}"> function </code></code><br/><br/><code> function_list </code><br/> <code title="{
int idx;
if((idx = lookup_symbol(&quot;main&quot;, FUN)) == -1)
	 err(&quot;undefined reference to 'main'&quot;);
else
	if(get_type(idx) != INT)
		warn(&quot;return type of 'main' is not int&quot;);
}"> program </code>
</body>
</html>